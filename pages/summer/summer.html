<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La fête c'est nous | pou l'été</title>

    <link rel="preload" as="image" href="../../assets/buttons/plus-info.png">
    <link rel="preload" as="image" href="../../assets/pictos/filled-star.png">
    <link rel="preload" as="image" href="../../assets/pictos/pinMap.png">
    <link rel="preload" as="image" href="../../assets/pictos/MusicNoteBeamed.png">
    <link rel="preload" as="image" href="../../assets/pictos/Clock.png">
    <link rel="preload" as="image" href="../../assets/pictos/PinMapmarron.png">
    <link rel="preload" as="image" href="../../assets/buttons/syrendre.png">
    <link rel="preload" as="image" href="../../assets/pictos/star-card.png">
    <link rel="preload" as="image" href="../../assets/buttons/savoirplusete.png">
    
    <style>

@font-face {
            font-family: 'inter-bold';
            src: url('../../assets/fonts/inter/Inter-Bold.otf') format('truetype');
        }

        @font-face {
            font-family: 'inter-semi-bold';
            src: url('../../assets/fonts/inter/Inter-SemiBold.otf') format('truetype');
        }

         @font-face {
            font-family: 'inter-medium';
            src: url('../../assets/fonts/inter/Inter-Medium.otf') format('truetype');
        }

          @font-face {
            font-family: 'inter-regular';
            src: url('../../assets/fonts/inter/Inter-Regular.otf') format('truetype');
        }
        @font-face {
            font-family: 'ubuntu-medium';
            src: url('../../assets/fonts/ubuntu/Ubuntu-M.ttf') format('truetype');
        }
        /* Global styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'inter-regular', sans-serif;
        }

        body {
            background-color: #fff;
            overflow-x: hidden;
            padding-bottom: 70px; /* Space for the fixed filter button */
        }
        
        /* Filter button fixed at bottom */
        .filter-button-container {
            position: fixed;
            bottom: 15px;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            z-index: 900;
        }
        
        .filter-button {
            width: 100px;
            height: auto;
            cursor: pointer;
            filter: drop-shadow(0 3px 5px rgba(0, 0, 0, 0.2));
        }
        
        /* Filter Overlay Styles */
        .filter-overlay {
            position: fixed;
            top: 8vh;
            left: 0;
            width: 100%;
            height: 92vh;
            background-color: #ffffff;
            z-index: 997;
            display: none;
            padding: 20px 15px 20px;
            overflow-y: auto;
            transition: transform 0.3s ease-in-out;
            transform: translateY(100%);
        }
        
        .filter-overlay.active {
            display: block;
            transform: translateY(0);
        }
        
        .filter-content {
            display: flex;
            flex-direction: column;
            width: 100%;
        }
        
        .back-to-program {
            color: #1f1e1e;
            text-decoration: none;
            font-size: 15px;
            margin-bottom: 20px;
            display: block;
        }
        
        .filter-section {
            margin-bottom: 25px;
        }
        
        .filter-headline {
            width: 45%;
            max-width: 170px;
            margin-bottom: 15px;
        }
        
        .filter-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: space-between;
        }
        
        .filter-chip {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 22%;
            padding: 8px 5px;
            border-radius: 10px;
            border: 2px solid #734432;
            background-color: white;
            color: #734432;
            font-size: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .filter-chip.active {
            background-color: #D892B4;
            border: 2px solid #D892B4;

            color: white;
        }
        
        .chip-icon {
            width: 30px;
            height: 30px;
            margin-bottom: 5px;
        }
        
        .filter-divider {
            height: 1px;
            width: 100%;
            background-color: #232323;
            margin: 10px 0;
        }
        
        .time-filter {
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        
        .time-selector {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 5px;
        }
        
        .time-selector span {
            color: #734432;
        }
        
        .time-select {
            padding: 8px 15px;
            border: 0px solid #D892B4;
            border-radius: 5px;
            color: #D892B4;
            background-color: white;
        }
        
        .location-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
           
        }
        
        .location-chip {
            width: fit-content;
            padding: 10px;
            padding-top: 7px;
            padding-bottom: 7px;
            border-radius: 10px;
            border: 1px solid #734432;
            color: #734432;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .location-chip.active {
            background-color: #D892B4;
            color: white;
            border-color: #D892B4;
        }
        
        .location-detail {
            font-size: 10px;
            color: inherit;
        }
        
        .validate-button-container {
            display: flex;
            justify-content: center;
            margin-top: 30px;
            margin-bottom: 20px;
        }
        
        .validate-button {
            width: 110px;
            cursor: pointer;
        }

         /* Navbar */
         .navbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 4.5rem;
            background-color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 0.9375rem;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .navbar-logo {
            height: 3.75rem;
            max-height: 85%;
        }

        .navbar-right {
            display: flex;
            align-items: center;
        }

        .favorites-btn {
            background-color: #D2775B;
            color: white;
            font-family: 'inter-bold', sans-serif;
            border: none;
            border-radius: 1.25rem;
            padding: 0.6rem 1.3rem;
            font-size: 0.875rem;
            margin-right: 0.9375rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .favorites-btn:active {
            transform: scale(0.95);
            opacity: 0.9;
        }
        
        @media (max-width: 360px) {
            .navbar {
                padding: 0 0.625rem;
            }
            
            .navbar-logo {
                height: 3.25rem;
            }
            
            .favorites-btn {
                padding: 0.4375rem 0.75rem;
                font-size: 0.75rem;
                margin-right: 0.625rem;
            }
        }

        .menu-icon {
            width: 30px;
            height: 20px;
            position: relative;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .menu-icon span {
            display: block;
            height: 3px;
            width: 100%;
            background-color: #D2775B;
            border-radius: 3px;
            transition: all 0.3s ease;
        }

        .menu-icon.active span:nth-child(1) {
            transform: translateY(8.5px) rotate(45deg);
        }

        .menu-icon.active span:nth-child(2) {
            opacity: 0;
        }

        .menu-icon.active span:nth-child(3) {
            transform: translateY(-8.5px) rotate(-45deg);
        }

        /* Menu overlay */
        .menu-overlay {
            position: fixed;
            top: 4.375rem;
            left: 0;
            width: 100%;
            height: calc(100vh - 4.375rem);
            background-color: white;
            z-index: 99;
            padding: 1.25rem;
            transform: translateY(-100%);
            opacity: 0;
            transition: transform 0.5s ease, opacity 0.5s ease;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .menu-overlay.active {
            transform: translateY(0);
            opacity: 1;
        }

        /* Favoris overlay */
        .favorites-overlay {
            position: fixed;
            top: 4.375rem;
            left: 0;
            width: 100%;
            height: calc(100vh - 4.375rem);
            background-color: white;
            z-index: 99;
            padding: 1.25rem;
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            text-align: center;
        }

        .favorites-overlay.active {
            display: block;
            opacity: 1;
        }

        .favorites-empty {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding-top: 2.5rem;
        }

        .favorites-empty img#favorites-icon {
            width: 90%;
            max-width: 900px;
            margin-bottom: 1.7rem;
        }
        
        .favorites-empty img#program-icon {
            width: 25%;
            max-width: 150px;
            margin-bottom: 1.5rem;
        }

        .favorites-empty img#program-btn {
            width: 50%;
            max-width: 300px;
            margin-bottom: 1.5rem;
        }

        .favorites-empty h3 {
            font-family: 'inter-semi-bold', sans-serif;
            color: #232222;
            font-weight: normal;
            margin-bottom: 1.7rem;
            font-size: 1.6rem;
            line-height: 1.4;
            text-align: center;
            width: 70%;
            max-width: 350px;
        }

        .favorites-empty .action-img {
            width: 50%;
            max-width: 230px;
            margin: 1rem 0;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .favorites-empty .action-img:hover {
            transform: scale(1.05);
        }

        .menu-item {
            padding: 1.125rem 0;
            font-size: 1.5rem;
            color: #D2775B;
            font-family: 'inter-bold', sans-serif;
            text-transform: uppercase;
            text-decoration: none;
            display: block;
            transition: color 0.3s ease;
        }
        
        .menu-item:active {
            opacity: 0.7;
        }

        .menu-divider {
            width: 100%;
            height: 1px;
            background-color: #D2775B;
            margin: 5px 0;
        }

        /* Main content styles - Programming Page */
        .content {
            margin-top: 8vh;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .header-image {
            margin-top: 2vh;
            width: 55%;
            max-width: 190px;
            margin-bottom: 20px;
        }

        /* Tab Navigation */
        .tab-navigation {
            display: flex;
            justify-content: space-around;
            width: 100%;
            margin-bottom: 20px;
        }

        .tab {
            padding: 8px 12px;
            color: #252525;
            font-weight: normal;
            font-family: 'inter-regular', sans-serif;
            cursor: pointer;
            position: relative;
            text-align: center;
        }

        .tab.active {
           
            font-family: 'inter-semi-bold', sans-serif;
            font-weight: normal;
            
        }
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -5px;
            font-family: 'inter-semi-bold', sans-serif;
            font-weight: normal;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: #252525;
        }

        /* Event Cards */
        .event-list {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

     /* Updated styles for the event cards matching the design in the image */
.event-card {
    font-family: 'inter-semi-bold', sans-serif;
    width: 100%;
    overflow: hidden;
    box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
    background-color: #fff;
    position: relative;
    margin-bottom: 20px;
    display: flex; /* Use flexbox to position the organizer bar */
}

/* Organizer color bar on the left */
.organizer-bar {
    width: 10px;
    background-color: #D892B4; /* Default color, will be overridden */
    height: auto;
}

.card-content {
    flex: 1;
    position: relative;
}

.card-image-container {
    position: relative;
    width: 100%;
    height: 180px;
    overflow: hidden;
}

.card-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

/* New organizer tag in top right corner */
.organizer-tag {
    position: absolute;
    top: 10px;
    right: 7px;
    background-color: #FF6B35; /* Default color, will be changed dynamically */
    color: white;
    padding: 5px 10px;
    font-size: 12px;
    font-weight: bold;

    z-index: 10;
}

.time-tag {
    position: absolute;
    top: 5px;
    left: 0px;
    background-color: #D892B4; /* Default color, will be changed dynamically */
    color: white;
    padding: 5px 10px;
    transform: rotate(-7deg);
    font-size: 12px;
    font-weight: bold;
    border-radius: 5px;
    box-shadow: 1px 1px 3px rgba(0,0,0,0.2);
    z-index: 10;
}

.card-info {
    padding: 15px;
    position: relative;
}

.event-title {
    font-family: 'inter-bold', sans-serif;
    text-transform: uppercase;
    color: #734432;
    font-size: 19px;
    font-weight: normal;
    margin-bottom: 3px;
}

.event-type {
    color: #777;
    font-size: 14px;
    margin-bottom: 3px;
}

.event-location {
    display: flex;
    align-items: center;
    margin-bottom: 2px;
    color: #734432;
    font-size: 14px;
}

.event-date {
    position: absolute;
    bottom: 15px;
    left: 15px;
    color: #734432;
    font-size: 16px;
    font-weight: bold;
}

.event-time {
    position: absolute;
    bottom: 12px;
    right: 15px;
    color: #734432;
    font-size: 16px;
    font-weight: bold;
}

.event-style {
    display: flex;
    align-items: center;
    margin-bottom: 30px;
    color: #734432;
    font-size: 14px;
}

.info-icon {
    width: 20px;
    height: 20px;
    margin-right: 8px;
}

.favorite-icon {
    position: absolute;
    top: 15px;
    right: 15px;
    width: 30px;
    height: 30px;
    cursor: pointer;
}

.info-btn {
    position: absolute;
    bottom: 45px;
    right: 15px;
    width: 100px;
    height: auto;
    cursor: pointer;
}

/* Rest of the styles remain unchanged */
/* Event Details Styles */


/* Loading state styles */
.event-card.loading {
    height: 320px;
}



.favorites-overlay.active {
    visibility: visible;
    opacity: 1;
}

.favorites-empty {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100%;
    padding: 20px;
    text-align: center;
}

.favorites-empty h3 {
    color: #734432;
    margin: 20px 0;
}

.favorites-empty #favorites-icon,
.favorites-empty #program-icon {
    width: 60px;
    height: 60px;
    margin: 10px 0;
}

.favorites-empty .action-img {
    width: 200px;
    margin-top: 20px;
    cursor: pointer;
}

.back-to-program {
    color: #734432;
    text-decoration: none;
    font-weight: bold;
    display: inline-block;
    margin-bottom: 10px;
}

/* Event list container */
.event-list {
    padding: 15px;
    max-width: 600px;
    margin: 0 auto;
}

/* General app

 /* Event Details Overlay */
 .event-details-overlay {
    position: fixed;
    top: 8vh;
    left: 0;
    width: 100%;
    height: 92vh;
    background-color: #ffffff;
    z-index: 999;
    display: flex;
    flex-direction: column;
    overflow-y: auto;
    opacity: 0;
    transform: scale(0.8);
    
    transform-origin: center center;
    transition: opacity 0.3s ease, visibility 0.3s ease;

}

.event-details-overlay.active {
    transform: scale(1);
    opacity: 1;
}

.event-details-container {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: space-between; /* This helps push partners to bottom */
}

.details-header {
    height: 100%;
    width: 100%;
    display: flex;
    flex-direction: column;
}

.details-image-container {
    position: relative;
    width: 100%;
    height: 260px; /* Increased height */
    overflow: hidden;
}

.details-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.close-details {
    position: absolute;
    top: 10px;
    right: 15px;
    width: 45px; /* Larger button */
    height: 45px; /* Larger button */
    background-color: #734432;
    border-radius: 50%;
    border: none;
    font-size: 26px;
    font-weight: bold;
    color: rgba(255, 255, 255, 0.9);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 2;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}

.details-title-section {
    padding: 20px; /* Increased padding */
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    background-color: #fff;
}

.details-title-left {
    flex: 1;
}

.details-title {
    color: #D2775B;
    font-family: 'inter-bold', sans-serif;
    font-size: 24px; /* Larger font */
    margin-bottom: 8px;
}

.details-subtitle {
    color: #403B23;
    font-weight: normal;
    font-size: 17px; /* Larger font */
    font-family: 'inter-medium', sans-serif;
}

.details-title-right {
    padding-left: 15px;
    padding-top: 5px;
}

.details-favorite-icon {
    width: 38px; /* Larger icon */
    height: 38px; /* Larger icon */
    cursor: pointer;
}

.details-description {
    padding: 0 20px 20px; /* Increased padding */
    color: #403B23;
    height: fit-content;
    font-size: 16px; /* Larger font */
    font-family: 'inter-regular', sans-serif;
    
}

.details-more-button {
    display: flex;
    justify-content: center;
    margin: 10px 0 25px; /* Increased margin */
}

.details-more-button img {
    height: 42px; /* Larger button */
    cursor: pointer;
    transition: transform 0.2s ease;
}

.details-more-button img:hover {
    transform: scale(1.05);
}

.details-info-section {
    padding: 0 20px 25px; /* Increased padding */
    display: flex;
    flex-direction: column;
    align-items: center;
}

.details-info-item {
    margin-top: auto; /* Pushes this section to the bottom */

    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 20px; /* Increased margin */
    color: #403B23;
    font-family: 'inter-semi-bold', sans-serif;
    font-size: 16px; /* Larger font */
}

.info-icon {
    width: 20px;
    height: 20px;
    margin-right: 6px;
}

.details-separator {
    margin: 0 15px; /* Increased margin */
    color: #403B23;
    font-weight: bold;
}

.details-map-button {
    width: 100%;
    display: flex;
    justify-content: center;
}

.details-map-button img {
    height: 43px; /* Larger button */
    cursor: pointer;
    transition: transform 0.2s ease;
}

.details-map-button img:hover {
    transform: scale(1.05);
}

.details-partners {
    background-color: #734432;
    color: white;
    padding: 25px 20px; /* Increased padding */
    margin-top: auto; /* Pushes this section to the bottom */
}

.details-partners h3 {
    text-align: center;
    font-size: 20px; /* Larger font */
    margin-bottom: 20px; /* Increased margin */
    letter-spacing: 1px;
}

.partners-grid {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 20px; /* Increased gap */
}

.partner-logo {
    width: 90px; /* Larger logo */
    height: 90px; /* Larger logo */
    object-fit: contain;
    background-color: white;
    border-radius: 8px; /* Increased radius */
    padding: 8px; /* Increased padding */
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    transition: transform 0.2s ease;
}

.partner-logo:hover {
    transform: scale(1.05);
}

/* Styles manquants ou à compléter */

/* Style pour l'étiquette de temps (horaire) sur l'image */
.details-time-tag {
    position: absolute;
    bottom: 15px;
    left: 15px;
    padding: 8px 12px;
    color: white;
    font-family: 'inter-bold', sans-serif;
    font-size: 14px;
    border-radius: 5px;
    z-index: 1;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}

/* Style pour l'organisateur */
.details-organizer {
    color: #734432;
    font-size: 14px;
    font-family: 'inter-medium', sans-serif;
    margin-top: 5px;
    font-weight: normal;
}

/* Correction pour assurer que le contenu s'affiche correctement */
.event-details-overlay {
    transform: none;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
}

.event-details-overlay.active {
    transform: none;
    opacity: 1;
    visibility: visible;
}

/* Assurer que les images des boutons ont une bonne taille */
.details-more-button img,
.details-map-button img {
    height: 42px;
    width: auto;
}

/* Améliorer l'affichage sur mobile */
@media (max-width: 768px) {
    .details-info-item {
        flex-wrap: wrap;
        justify-content: center;
        text-align: center;
    }
    
    .details-separator {
        margin: 5px 15px;
        display: none;
    }
    
    .details-info-item > * {
        margin: 5px;
    }
}


/* Styles manquants ou à compléter */

/* Style pour la date et le lieu sous l'organisateur */
.details-date-location {
    color: #272727;
    font-size: 17px;
    font-family: 'inter-bold', sans-serif;
    margin-top: 20px;
}

/* Style pour l'organisateur */
.details-organizer {
    color: #262626;
    font-size: 14px;
    font-family: 'inter-medium', sans-serif;
    margin-top: 5px;
}

/* Correction pour assurer que le contenu s'affiche correctement */
.event-details-overlay {
    transform: none;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
}

.event-details-overlay.active {
    transform: none;
    opacity: 1;
    visibility: visible;
}

/* Assurer que les images des boutons ont une bonne taille */
.details-more-button img,
.details-map-button img {
    height: 42px;
    width: auto;
}

/* Améliorer l'affichage sur mobile */
@media (max-width: 768px) {
    .details-info-item {
        flex-wrap: wrap;
        justify-content: center;
        text-align: center;
    }
    
    .details-separator {
        margin: 5px 15px;
        display: none;
    }
    
    .details-info-item > * {
        margin: 5px;
    }
}
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <a href="../../index.html"> <img src="../../assets/logo/logo-navbar-fdlm-orange.png" alt="Logo" class="navbar-logo"></a>
        <div class="navbar-right">
            <button class="favorites-btn">Mes favoris</button>
            <div class="menu-icon">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>
    
    <!-- Menu overlay -->
    <div class="menu-overlay">
        <a href="../../index.html" class="menu-item" style="margin-bottom: 2vh;">Accueil</a>
        <a href="../programmation/programmation.html" class="menu-item">Programmation</a>
        <div class="menu-divider"></div>
        <a href="#" class="menu-item">Mes favoris</a>
        <div class="menu-divider"></div>
        <a href="#" class="menu-item">Autour de moi</a>
        <div class="menu-divider"></div>
        <a href="#" class="menu-item" style="margin-bottom: 3vh;">Nos partenaires</a>
        <a href="../apropos/apropos.html" class="menu-item">Qui sommes-nous ?</a>
        <div class="menu-divider"></div>
        <a href="summer.html" class="menu-item">Pour l'été</a>
    </div>
    
    <!-- Favoris overlay -->
    <div class="favorites-overlay">
        <div class="favorites-empty">
            <img src="../../assets/headline/programmation-outline.png" alt="Icône favoris" id="favorites-icon">
            <h3>Vous n'avez pas encore sélectionné de programme favoris</h3>
            <img src="../../assets/pictos/material-symbols_stars-outline.png" alt="Icône programme" id="program-icon">
            <h3>Rendez-vous sur la programmation pour faire votre choix</h3>
            <img src="../../assets/buttons/programmation-button.png" alt="Aller à la programmation" class="action-img" id="go-to-program">
        </div>
    </div>

    <!-- Main Content - Programming Page -->
    <div class="content">
        <!-- Header Image -->
        <img src="../../assets/headline/for-summer.png" alt="Programmation" class="header-image">
        
       
        
        <!-- Event List -->
        <div class="event-list">
          
        </div>
    </div>

   
    
    
    
<script type="module">// Import Firebase modules
   // Import Firebase modules
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-analytics.js";

// Firebase configuration
const firebaseConfig = {
    apiKey: "AIzaSyCwtimDB_Mai-QPyB6d0yqjJX_d5mQjGY8",
    authDomain: "fete-de-la-musique-64a6b.firebaseapp.com",
    projectId: "fete-de-la-musique-64a6b",
    storageBucket: "fete-de-la-musique-64a6b.firebasestorage.app",
    messagingSenderId: "1087878331068",
    appId: "1:1087878331068:web:28719d3278a619cb816eb9",
    measurementId: "G-MW9YYKP1J8"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const analytics = getAnalytics(app);

// Global variables
let allEvents = [];

// DOM Elements
const eventList = document.querySelector('.event-list');

// Function to format time from timestamp (HHhMM)
function formatTime(timestamp) {
    const date = new Date(timestamp * 1000);
    return date.getHours().toString().padStart(2, '0') + 'h' + date.getMinutes().toString().padStart(2, '0');
}

// Function to format date from timestamp (DD/MM/YYYY)
function formatDate(timestamp) {
    const date = new Date(timestamp * 1000);
    return date.getDate().toString().padStart(2, '0') + '/' + 
           (date.getMonth() + 1).toString().padStart(2, '0') + '/' + 
           date.getFullYear();
}

// Function to format weekday from timestamp (VEN. for Friday, etc.)
function formatWeekday(timestamp) {
    const date = new Date(timestamp * 1000);
    const days = ['DIM.', 'LUN.', 'MAR.', 'MER.', 'JEU.', 'VEN.', 'SAM.'];
    return days[date.getDay()];
}

// Function to format day and month from timestamp (14 mars)
function formatDayMonth(timestamp) {
    const date = new Date(timestamp * 1000);
    const months = ['janvier', 'février', 'mars', 'avril', 'mai', 'juin', 'juillet', 'août', 'septembre', 'octobre', 'novembre', 'décembre'];
    return date.getDate() + ' ' + months[date.getMonth()];
}

// Function to check if an event is in favorites
function isEventFavorite(eventId) {
    return getCookie('favorite_event_' + eventId) === 'true';
}

// Function to toggle favorite status
function toggleFavorite(eventId, icon) {
    if (isEventFavorite(eventId)) {
        deleteCookie('favorite_event_' + eventId);
        icon.src = '../../assets/pictos/star-card.png';
    } else {
        setCookie('favorite_event_' + eventId, 'true', 30);
        icon.src = '../../assets/pictos/filled-star.png';
    }
}

// Function to get color based on organizer
function getOrganizerColor(organizer) {
    // You can define a mapping of organizers to colors
    const colorMap = {
        'FORNAP': '#FF6B35',
        'Ville de Nice': '#4ECDC4',
        'Association Musicale': '#FF5964',
        'Club Brise-Glace': '#38618C',
        'Conservatoire': '#35A7FF',
        // Add more organizers and their colors as needed
        'default': '#D892B4'  // Default color if organizer not found
    };
    
    return colorMap[organizer] || colorMap['default'];
}

// Function to create loading card skeleton - Updated for new design
function createLoadingCard() {
    const card = document.createElement('div');
    card.className = 'event-card loading';
    card.innerHTML = `
        <div class="organizer-bar" style="background-color: #eee;"></div>
        <div class="card-content">
            <div class="card-image-container" style="background-color: #eee;">
                <div class="time-tag" style="background-color: #ddd; color: transparent;">00:00</div>
                <div class="organizer-tag" style="background-color: #ddd; color: transparent;">ORG</div>
            </div>
            <div class="card-info">
                <div class="event-title" style="background-color: #eee; height: 20px; width: 70%; margin-bottom: 10px;"></div>
                <div class="event-type" style="background-color: #eee; height: 16px; width: 40%; margin-bottom: 15px;"></div>
                <div class="event-location" style="background-color: #eee; height: 16px; width: 80%; margin-bottom: 10px;"></div>
                <div class="event-date" style="background-color: #eee; height: 16px; width: 60%; margin-bottom: 10px;"></div>
                <div class="event-style" style="background-color: #eee; height: 16px; width: 60%; margin-bottom: 10px;"></div>
                <div class="event-time" style="background-color: #eee; height: 16px; width: 40px; position: absolute; bottom: 15px; right: 15px;"></div>
            </div>
        </div>
    `;
    return card;
}

// Function to show loading state with shimmer effect
function showLoading() {
    eventList.innerHTML = '';
    for (let i = 0; i < 6; i++) {
        const loadingCard = createLoadingCard();
        eventList.appendChild(loadingCard);
    }
    
    // Add shimmer effect with CSS
    const style = document.createElement('style');
    style.id = 'skeleton-animation';
    style.textContent = `
        @keyframes shimmer {
            0% {
                background-position: -200% 0;
            }
            100% {
                background-position: 200% 0;
            }
        }
        
        .event-card.loading .organizer-bar,
        .event-card.loading .card-image-container,
        .event-card.loading .event-title,
        .event-card.loading .event-type,
        .event-card.loading .event-location,
        .event-card.loading .event-date,
        .event-card.loading .event-style,
        .event-card.loading .event-time,
        .event-card.loading .organizer-tag {
            background: linear-gradient(90deg, #eee 8%, #f5f5f5 18%, #eee 33%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite linear;
        }
    `;
    document.head.appendChild(style);
}

// Function to create event card - Updated to match new design
function createEventCard(event) {
    const card = document.createElement('div');
    card.className = 'event-card';
    card.setAttribute('data-id', event.id);
    card.setAttribute('data-genre', event.genre);
    
    // Parse the timestamp for various format displays
    // Assuming event.timestamp is a Firestore timestamp object or has seconds property
    const timestampValue = event.timestamp.seconds || event.timestamp;
    
    // Format event date information
    const formattedWeekday = formatWeekday(timestampValue);
    const formattedDayMonth = formatDayMonth(timestampValue);
    const formattedTime = formatTime(timestampValue);
    
    // Get organizer color
    const organizerColor = getOrganizerColor(event.organizer);
    
    // Set favorite icon based on cookie
    const favoriteIconSrc = isEventFavorite(event.id) ? 
        '../../assets/pictos/filled-star.png' : 
        '../../assets/pictos/star-card.png';
    
    card.innerHTML = `
        <div class="organizer-bar" style="background-color: ${organizerColor};"></div>
        <div class="card-content">
            <div class="card-image-container">
                <img src="${event.imageUrl}" alt="${event.title}" class="card-image">
                <div class="organizer-tag" style="background-color: ${organizerColor};">${event.organizer}</div>
            </div>
            <div class="card-info">
                <h3 class="event-title">${event.title}</h3>
                <p class="event-type">${event.subtitle || 'Type d\'événement'}</p>
                <div class="event-location">
                    <img src="../../assets/pictos/pinMap.png" alt="Location" class="info-icon">
                    <span>${event.location}</span>
                </div>
               
                <div class="event-style">
                    <img src="../../assets/pictos/MusicNoteBeamed.png" alt="Music" class="info-icon">
                    <span>${event.genre}</span>
                </div>
                 <div class="event-date">
                    <span>${formattedWeekday} ${formattedDayMonth}</span>
                </div>
                <div class="event-time">${formattedTime}</div>
                
                
            </div>
        </div>
    `;
    
   
    
    return card;
}

// Function to show event details (modal or page) - Updated for new timestamp format
function showEventDetails(event) {
    console.log('Show details for event:', event);
    
    // Create a modal or overlay for event details
    const detailsOverlay = document.createElement('div');
    detailsOverlay.className = 'event-details-overlay';
    
    // Set the favorite icon based on cookie
    const favoriteIconSrc = isEventFavorite(event.id) ? 
        './assets/pictos/filled-star.png' : 
        './assets/pictos/star-card.png';
    
    // Get organizer color
    const organizerColor = getOrganizerColor(event.organizer);
    
    // Format timestamp information
    const timestampValue = event.timestamp.seconds || event.timestamp;
    const startTime = formatTime(timestampValue);
    // For end time, we'll add 2 hours as default if not specified
    const endTime = event.timestamp_end ? 
        formatTime(event.timestamp_end) : 
        formatTime(timestampValue + 7200); // 2 hours = 7200 seconds
    const timeTag = `${startTime}-${endTime}`;
    
    // Format date for display
    const formattedWeekday = formatWeekday(timestampValue);
    const formattedDate = formatDate(timestampValue);
    
    detailsOverlay.innerHTML = `
        <div class="event-details-container">
            <div class="details-header">
                <div class="details-image-container">
                    <img src="${event.imageUrl}" alt="${event.title}" class="details-image">
                    <button class="close-details">×</button>
                </div>
                
                <div class="details-title-section">
                    <div class="details-title-left">
                        <h2 class="details-title">${event.title}</h2>
                        <p class="details-subtitle">${event.subtitle || 'Type d\'événement'}</p>
                        <p class="details-organizer">Organisé par: ${event.organizer}</p>
                        <p class="details-date-location">${formattedWeekday} ${formattedDate} | ${event.location}</p>
                    </div>
                   
                </div>
                
                <div class="details-description">
                    <p>${event.description}</p>
                </div>
                
                ${event.plusUrl ? `
                <div class="details-more-button">
                    <a href="${event.plusUrl}" target="_blank">
                        <img src="../../assets/buttons/savoirplusmarron.png" alt="En savoir plus">
                    </a>
                </div>` : ''}
                
                <div class="details-info-section">
                   
                    
                    <div class="details-map-button">
                        <a href="${event.plusUrl}" target="_blank">
                            <img src="../../assets/buttons/savoirplusete.png" alt="Comment s'y rendre">
                        </a>
                    </div>
                </div>
                
                <div class="details-partners">
                    <h3>PARTENAIRES</h3>
                    <div class="partners-grid">
                        ${event.partners && event.partners.length > 0 ? 
                            event.partners.map(partner => `
                                <img src="${partner}" alt="Partenaire" class="partner-logo">
                            `).join('') : 
                            '<p>Aucun partenaire</p>'
                        }
                    </div>
                </div>
            </div>
        </div>
    `;
    
    document.body.appendChild(detailsOverlay);
    
    // Add history state to handle back button
    history.pushState({overlay: 'event-details'}, '');
    
    // Animate the overlay - ensure class is added AFTER DOM is updated
    requestAnimationFrame(() => {
        detailsOverlay.classList.add('active');
    });
    
    // Add event listeners
    detailsOverlay.querySelector('.close-details').addEventListener('click', () => {
        detailsOverlay.classList.remove('active');
        setTimeout(() => {
            detailsOverlay.remove();
            // Remove history state to avoid double-back
            history.back();
        }, 300);
    });
    
    // Add to favorites button
    const favIcon = detailsOverlay.querySelector('.details-favorite-icon');
    favIcon.addEventListener('click', () => {
        const isFav = isEventFavorite(event.id);
        const favIcons = document.querySelectorAll(`.favorite-icon[data-id="${event.id}"]`);
        
        // Toggle the cookie
        toggleFavorite(event.id, favIcon);
        
        // Update other instances of the same favorite icon
        favIcons.forEach(icon => {
            icon.src = isFav ? './assets/pictos/star-card.png' : './assets/pictos/filled-star.png';
        });
    });
}
// Function to fetch events from Firestore with min loading time - Changed to work with new timestamp format
async function fetchEvents() {
    showLoading(); // Show loading state
    
    const startTime = Date.now();
    
    try {
        const eventsCol = collection(db, "summer_events"); // Changed from "events" to "summer_events"
        const eventSnapshot = await getDocs(eventsCol);
        
        // Process each document
        allEvents = [];
        eventSnapshot.forEach((doc) => {
            const eventData = doc.data();
            const event = {
                id: doc.id,
                title: eventData.title || 'Événement sans titre',
                subtitle: eventData.subtitle || '',
                imageUrl: eventData.imageUrl || 'assets/default-event.jpg',
                location: eventData.location || 'Lieu non spécifié',
                genre: eventData.genre || 'Genre non spécifié',
                organizer: eventData.organizer || 'Organisateur non spécifié',
                // Handle different timestamp formats
                timestamp: eventData.timestamp || {
                    seconds: eventData.timestamp_start || 0,
                    nanoseconds: 0
                },
                timestamp_end: eventData.timestamp_end,
                locationUrl: eventData.locationUrl || '',
                description: eventData.description || 'Aucune description disponible',
                partners: eventData.partners || [],
                plusUrl: eventData.plusUrl || ''
            };
            
            allEvents.push(event);
        });
        
        console.log('Loaded events:', allEvents.length);
        
        // Ensure skeleton loader stays visible for at least 1 second
        const elapsedTime = Date.now() - startTime;
        const remainingTime = Math.max(0, 1000 - elapsedTime);
        
        setTimeout(() => {
            // Remove skeleton animation style
            const skeletonStyle = document.getElementById('skeleton-animation');
            if (skeletonStyle) skeletonStyle.remove();
            
            // Clear loading state
            eventList.innerHTML = '';
            
            // Sort events by start time
            allEvents.sort((a, b) => {
                const aTime = a.timestamp.seconds || a.timestamp;
                const bTime = b.timestamp.seconds || b.timestamp;
                return aTime - bTime;
            });
            
            // Update display with events
            updateEventList(allEvents);
        }, remainingTime);
        
    } catch (error) {
        console.error("Error fetching events:", error);
        
        // Show error after at least 1 second to avoid flickering
        const elapsedTime = Date.now() - startTime;
        const remainingTime = Math.max(0, 600 - elapsedTime);
        
        setTimeout(() => {
            eventList.innerHTML = '<p style="color: #734432; text-align: center; padding: 20px;">Erreur lors du chargement des événements. Veuillez réessayer.</p>';
        }, remainingTime);
    }
}

// Modification 1 : Ajouter un gestionnaire d'événements après création des cartes
function updateEventList(events) {
    eventList.innerHTML = '';
    
    if (events.length === 0) {
        eventList.innerHTML = '<p style="color: #734432; text-align: center; padding: 20px;">Aucun événement trouvé.</p>';
        return;
    }
    
    events.forEach(event => {
        const card = createEventCard(event);
        
        // Ajouter un événement de clic à chaque carte
        card.addEventListener('click', () => {
            // Trouver l'événement correspondant
            const clickedEvent = allEvents.find(e => e.id === event.id);
            if (clickedEvent) {
                showEventDetails(clickedEvent);
            }
        });
        
        eventList.appendChild(card);
    });
}

// Cookie functions
function setCookie(name, value, days) {
    const expires = new Date();
    expires.setTime(expires.getTime() + (days * 24 * 60 * 60 * 1000));
    document.cookie = name + '=' + value + ';expires=' + expires.toUTCString() + ';path=/';
}

function getCookie(name) {
    const nameEQ = name + '=';
    const ca = document.cookie.split(';');
    for (let i = 0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0) === ' ') c = c.substring(1, c.length);
        if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
    }
    return null;
}

function deleteCookie(name) {
    document.cookie = name + '=;expires=Thu, 01 Jan 1970 00:00:01 GMT;path=/';
}

// Modification 2 : Même chose pour les cartes dans les favoris
function loadFavorites() {
    const favoritesOverlay = document.querySelector('.favorites-overlay');
    favoritesOverlay.innerHTML = ''; // Clear previous content
    
    // Filter events that are in favorites
    const favoriteEvents = allEvents.filter(event => isEventFavorite(event.id));
    
    if (favoriteEvents.length === 0) {
        // Show empty state
        favoritesOverlay.innerHTML = `
            <div class="favorites-empty">
                <img src="../../assets/headline/programmation-outline.png" alt="Icône favoris" id="favorites-icon">
                <h3>Vous n'avez pas encore sélectionné de programme favoris</h3>
                <img src="../../assets/pictos/material-symbols_stars-outline.png" alt="Icône programme" id="program-icon">
                <h3>Rendez-vous sur la programmation pour faire votre choix</h3>
                <img src="../../assets/buttons/programmation-button.png" alt="Aller à la programmation" class="action-img" id="go-to-program">
            </div>
        `;
        
        // Add event listener for "go to program" button
        document.getElementById('go-to-program').addEventListener('click', () => {
            favoritesOverlay.classList.remove('active');
        });
    } else {
        // Create header for favorites overlay
        const favHeader = document.createElement('div');
        favHeader.style.width = '100%';
        favHeader.style.padding = '10px 15px';
        favHeader.innerHTML = `
            <a href="#" class="back-to-program" id="back-from-favorites">← Retour vers la programmation</a>
            <img src="../../assets/headline/favoris.png" alt="Mes Favoris" style="width: 70%;
max-width: 300px; margin: 20px auto; display: block;">
        `;
        favoritesOverlay.appendChild(favHeader);
        
        // Create container for favorite events
        const favoriteContainer = document.createElement('div');
        favoriteContainer.className = 'event-list';
        favoriteContainer.style.padding = '0 15px';
        
        // Add each favorite event
        favoriteEvents.forEach(event => {
            const card = createEventCard(event);
            
            // Ajouter un événement de clic à chaque carte favorite
            card.addEventListener('click', () => {
                // Trouver l'événement correspondant
                const clickedEvent = allEvents.find(e => e.id === event.id);
                if (clickedEvent) {
                    showEventDetails(clickedEvent);
                }
            });
            
            favoriteContainer.appendChild(card);
        });
        
        favoritesOverlay.appendChild(favoriteContainer);
        
        // Add event listener for back button
        document.getElementById('back-from-favorites').addEventListener('click', (e) => {
            e.preventDefault();
            favoritesOverlay.classList.remove('active');
        });
    }
}

// Document ready function
document.addEventListener('DOMContentLoaded', () => {
    // Fetch events when page loads
    fetchEvents();
    
    // Menu toggle
    const menuIcon = document.querySelector('.menu-icon');
    const menuOverlay = document.querySelector('.menu-overlay');
    
    if (menuIcon && menuOverlay) {
        menuIcon.addEventListener('click', () => {
            menuOverlay.classList.toggle('active');
        });
    }
    
    // Favorites toggle
    const favoritesBtn = document.querySelector('.favorites-btn');
    const favoritesOverlay = document.querySelector('.favorites-overlay');
    
    if (favoritesBtn && favoritesOverlay) {
        favoritesBtn.addEventListener('click', () => {
            loadFavorites();
            favoritesOverlay.classList.toggle('active');
        });
    }
    
    // Handle history navigation (back button)
    window.addEventListener('popstate', () => {
        // Close any open overlays
        const overlays = document.querySelectorAll('.favorites-overlay, .event-details-overlay');
        overlays.forEach(overlay => {
            if (overlay.classList.contains('active')) {
                overlay.classList.remove('active');
                if (overlay.classList.contains('event-details-overlay')) {
                    setTimeout(() => overlay.remove(), 300);
                }
            }
        });
    });
});</script>
</body>
</html>