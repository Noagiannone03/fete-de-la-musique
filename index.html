<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Fête c'est Nous - Fête de la Musique 2025 | Programmation et Événements Musicaux</title>
    
    <!-- Meta description pour le SEO -->
    <meta name="description" content="Découvrez la programmation complète de la Fête de la Musique 2025 avec La Fête c'est Nous. Concerts, spectacles, événements musicaux près de chez vous. Consultez les horaires, lieux et créez vos favoris.">
    
    <!-- Meta mots-clés -->
    <meta name="keywords" content="fête de la musique, concert, musique, programmation, événements musicaux, spectacle, festival, musique live, artistes, 21 juin">
    
    <!-- Meta robots -->
    <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow">
    
    <!-- Meta author -->
    <meta name="author" content="La Fête c'est Nous">
    
    <!-- Meta langue -->
    <meta name="language" content="fr-FR">
    
    <!-- Open Graph pour Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="La Fête c'est Nous - Fête de la Musique 2024">
    <meta property="og:description" content="Découvrez la programmation complète de la Fête de la Musique 2024. Concerts, spectacles et événements musicaux près de chez vous.">
    <meta property="og:image" content="assets/images/affiche-mobile@2x.png">
    <meta property="og:url" content="">
    <meta property="og:site_name" content="La Fête c'est Nous">
    <meta property="og:locale" content="fr_FR">
    
    <!-- Twitter Cards -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="La Fête c'est Nous - Fête de la Musique 2024">
    <meta name="twitter:description" content="Découvrez la programmation complète de la Fête de la Musique 2024. Concerts, spectacles et événements musicaux près de chez vous.">
    <meta name="twitter:image" content="assets/images/affiche-mobile@2x.png">
    
    <!-- Meta pour mobile et PWA -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Fête de la Musique">
    <meta name="theme-color" content="#734432">
    <meta name="msapplication-navbutton-color" content="#734432">
    <meta name="apple-mobile-web-app-status-bar-style" content="#734432">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/logo/favicon.png">
    <link rel="apple-touch-icon" href="assets/logo/apple-touch-icon.png">
    
    <!-- Schema.org structured data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Event",
        "name": "Fête de la Musique 2024",
        "description": "Découvrez la programmation complète de la Fête de la Musique 2024 avec concerts, spectacles et événements musicaux.",
        "startDate": "2024-06-21",
        "endDate": "2024-06-21",
        "eventStatus": "https://schema.org/EventScheduled",
        "eventAttendanceMode": "https://schema.org/OfflineEventAttendanceMode",
        "organizer": {
            "@type": "Organization",
            "name": "La Fête c'est Nous"
        },
        "image": "assets/images/affiche-mobile@2x.png",
        "url": ""
    }
    </script>
    
    <script>
(function() {
  // 1) Détection "moderne" (Chrome, Edge, Opera) via userAgentData
  const uaData = navigator.userAgentData;
  let isMobile = false;

  if (uaData && Array.isArray(uaData.mobile)) {
    // userAgentData.mobile est true sur mobile Chrome récent
    isMobile = uaData.mobile === true;
  } else {
    // 2) Fallback classique sur userAgent
    const ua = navigator.userAgent || navigator.vendor || window.opera;
    isMobile = /Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(ua);
  }

  // Si CE N'EST PAS un mobile, on redirige
  if (!isMobile) {
    // Remplacez cette URL par celle de la page vers laquelle rediriger PC / tablette
    const redirectUrl = "pages/redirect/redirection.html";
    // Pour éviter les boucles de redirection, vérifiez qu'on n'y est pas déjà
    if (window.location.href.indexOf(redirectUrl) === -1) {
      window.location.replace(redirectUrl);
    }
  }
})();
</script>
    
    <link rel="stylesheet" href="assets/css/popup.css">
    <script src="assets/js/popup.js" defer></script>
    <!-- Module de gestion des favoris -->
    <script src="utils/favorites-manager.js"></script>
    <style>
        @font-face {
            font-family: 'inter-bold';
            src: url('assets/fonts/inter/Inter-Bold.otf') format('truetype');
        }

        @font-face {
            font-family: 'inter-semi-bold';
            src: url('assets/fonts/inter/Inter-SemiBold.otf') format('truetype');
        }
        @font-face {
            font-family: 'ubuntu-medium';
            src: url('assets/fonts/ubuntu/Ubuntu-M.ttf') format('truetype');
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }

        html {
            font-size: 16px;
        }

        body {
            background-color: #ffffff;
            overflow-x: hidden;
            width: 100%;
        }
        
        /* Responsive font sizes */
        @media (max-width: 375px) {
            html {
                font-size: 14px;
            }
        }
        
        @media (min-width: 500px) {
            html {
                font-size: 17px;
            }
        }
        
        @media (min-width: 768px) {
            html {
                font-size: 18px;
            }
        }

        /* Écran de chargement */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #d791b4;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 7000;
            transition: opacity 0.8s ease, transform 0.8s ease;
        }

        .loading-screen.hide {
            opacity: 0;
            transform: translateY(-100%);
            pointer-events: none;
        }

        .logo-container {
            width: 260px;
            height: 260px;
            display: flex;
            justify-content: center;
            align-items: center;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .logo {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        
        .logo img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        /* Navbar */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 4.5rem !important;
            background-color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 0.9375rem;
            z-index: 1002;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .navbar-logo {
            height: 3.75rem;
            max-height: 85%;
        }

        .navbar-right {
            display: flex;
            align-items: center;
        }

        .favorites-btn {
            background-color: #734432;
            color: white;
            font-family: 'inter-bold', sans-serif;
            border: none;
            border-radius: 1.25rem;
            padding: 0.6rem 1.3rem;
            font-size: 0.875rem;
            margin-right: 0.9375rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .favorites-btn:active {
            transform: scale(0.95);
            opacity: 0.9;
        }
        
        @media (max-width: 360px) {
            .navbar {
                padding: 0 0.625rem;
            }
            
            .navbar-logo {
                height: 3.25rem;
            }
            
            .favorites-btn {
                padding: 0.4375rem 0.75rem;
                font-size: 0.75rem;
                margin-right: 0.625rem;
            }
        }

        .menu-icon {
            width: 30px;
            height: 20px;
            position: relative;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .menu-icon span {
            display: block;
            height: 3px;
            width: 100%;
            background-color: #734432;
            border-radius: 3px;
            transition: all 0.3s ease;
        }

        .menu-icon.active span:nth-child(1) {
            transform: translateY(8.5px) rotate(45deg);
        }

        .menu-icon.active span:nth-child(2) {
            opacity: 0;
        }

        .menu-icon.active span:nth-child(3) {
            transform: translateY(-8.5px) rotate(-45deg);
        }

        /* Menu overlay */
        .menu-overlay {
            position: fixed;
            top: 4.375rem;
            left: 0;
            width: 100%;
            height: calc(100vh - 4.375rem);
            background-color: white;
            z-index: 1001;
            padding: 1.25rem;
            transform: translateY(-100%);
            opacity: 0;
            transition: transform 0.5s ease, opacity 0.5s ease;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            pointer-events: none;
        }

        .menu-overlay.active {
            transform: translateY(0);
            opacity: 1;
            pointer-events: auto;
        }

        /* Favoris overlay */
        .favorites-overlay {
            position: fixed;
            top: 4.375rem;
            left: 0;
            width: 100%;
            height: calc(100vh - 4.375rem);
            background-color: white;
            z-index: 1001;
            padding: 1.25rem;
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            pointer-events: none;
        }

        .favorites-overlay.active {
            display: block;
            opacity: 1;
            pointer-events: auto;
        }

        .favorites-empty {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding-top: 2.5rem;
        }

        .favorites-empty img#favorites-icon {
            width: 90%;
            max-width: 900px;
            margin-bottom: 1.7rem;
        }
        
        .favorites-empty img#program-icon {
            width: 25%;
            max-width: 150px;
            margin-bottom: 1.5rem;
        }

        .favorites-empty img#program-btn {
            width: 50%;
            max-width: 300px;
            margin-bottom: 1.5rem;
        }

        .favorites-empty h3 {
            font-family: 'inter-semi-bold', sans-serif;
            color: #232222;
            font-weight: normal;
            margin-bottom: 1.7rem;
            font-size: 1.6rem;
            line-height: 1.4;
            text-align: center;
            width: 70%;
            max-width: 350px;
        }

        .favorites-empty .action-img {
            width: 50%;
            max-width: 230px;
            margin: 1rem 0;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .favorites-empty .action-img:hover {
            transform: scale(1.05);
        }

        /* Styles pour l'overlay des détails d'événement */
        .event-details-overlay {
            position: fixed;
            top: 8vh;
            left: 0;
            width: 100%;
            height: 92vh;
            background-color: #ffffff;
            z-index: 999;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            opacity: 0;
            transform: scale(0.8);
            transition: transform 0.4s ease-out, opacity 0.3s ease-out;
            transform-origin: center center;
        }
        
        .event-details-overlay.active {
            transform: scale(1);
            opacity: 1;
        }
        
        .event-details-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .details-header {
            width: 100%;
            display: flex;
            flex-direction: column;
            flex: 1;
            min-height: 0;
        }
        
        .details-image-container {
            width: 100%;
            aspect-ratio: 12 / 9;
            overflow: hidden;
            flex-shrink: 0;
            position: relative;
        }
        
        .details-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
            display: block;
        }
        
        .close-details {
            position: absolute;
            top: 10px;
            right: 15px;
            width: 45px;
            height: 45px;
            background-color: #734432;
            border-radius: 50%;
            border: none;
            font-size: 26px;
            font-weight: bold;
            color: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 2;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .details-title-section {
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            background-color: #fff;
            flex-shrink: 0;
        }
        
        .details-title-left {
            flex: 1;
        }
        
        .details-title {
            color: #D2775B;
            font-family: 'inter-bold', sans-serif;
            font-size: 24px;
            margin-bottom: 8px;
        }
        
        .details-subtitle {
            color: #403B23;
            font-size: 18px;
            font-family: 'inter-medium', sans-serif;
        }
        
        .details-favorite {
            padding-left: 15px;
            padding-top: 5px;
        }
        
        .details-favorite-icon {
            width: 38px;
            height: 38px;
            cursor: pointer;
        }
        
        .details-description {
            padding: 0 20px 20px;
            color: #403B23;
            font-size: 16px;
            font-family: 'inter-regular', sans-serif;
        }
        
        .details-more-button {
            padding: 0 20px 20px;
            display: flex;
            justify-content: start;
            margin: 10px 0 25px;
            flex-shrink: 0;
        }
        
        .details-more-button img {
            height: 35px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .details-more-button img:hover {
            transform: scale(1.05);
        }
        
        .details-info-section {
            padding: 0 20px 25px;
            display: flex;
            flex-direction: column;
            align-items: center;
            flex-shrink: 0;
        }
        
        .details-time-location {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            color: #403B23;
            font-family: 'inter-semi-bold', sans-serif;
            font-size: 16px;
        }
        
        .details-time, .details-location {
            display: flex;
            align-items: center;
        }
        
        .info-icon {
            width: 20px;
            height: 20px;
            margin-right: 6px;
        }
        
        .details-separator {
            margin: 0 15px;
            color: #403B23;
            font-weight: bold;
        }
        
        .details-info-item {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            color: #403B23;
            font-family: 'inter-semi-bold', sans-serif;
            font-size: 16px;
        }
        
        .details-map-button {
            width: 100%;
            display: flex;
            justify-content: center;
            margin-top: 15px;
        }
        
        .details-map-button img {
            height: 43px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .details-map-button img:hover {
            transform: scale(1.05);
        }
        
        .details-partners {
            background-color: #734432;
            color: white;
            padding: 25px 20px;
            flex-shrink: 0;
            margin-top: auto;
        }
        
        .details-partners h3 {
            text-align: center;
            font-size: 20px;
            margin-bottom: 20px;
            letter-spacing: 1px;
            font-family: 'inter-bold', sans-serif;
            color: white;
        }
        
        .partners-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            padding: 0 10px;
        }
        
        .details-partner {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 90px;
            text-decoration: none;
            cursor: pointer;
        }
        
        .partner-logo {
            width: 90px;
            height: 90px;
            object-fit: cover;
            background-color: white;
            padding: 2px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.2s ease;
            border: none;
        }
        
        .details-partner:hover .partner-logo {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .partner-name {
            font-size: 12px;
            text-align: center;
            color: white;
            font-family: 'inter-regular', sans-serif;
            line-height: 1.3;
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }
        
        .details-contact-info {
            padding: 0 20px 20px;
        }
        
        .contact-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 10px;
            color: #333;
            font-size: 0.95rem;
        }
        
        .contact-item .info-icon {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            margin-top: 2px;
        }
        
        /* Skeleton loading */
        @keyframes skeleton-loading {
            0% { background-position: -200px 0; }
            100% { background-position: calc(200px + 100%) 0; }
        }
        
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200px 100%;
            animation: skeleton-loading 1.5s infinite linear;
            border-radius: 4px;
            height: 20px;
            margin-bottom: 10px;
        }
        
        .skeleton-partner {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            margin: 0 5px 15px;
        }
        
        .skeleton-image {
            height: 200px;
            background-color: #eee;
        }
        
        .skeleton-title {
            height: 28px;
            width: 70%;
            background-color: #eee;
            margin-bottom: 10px;
        }
        
        .skeleton-subtitle {
            height: 20px;
            width: 50%;
            background-color: #eee;
        }
        
        .skeleton-description {
            height: 100px;
            background-color: #eee;
        }
        
        .skeleton-info {
            height: 20px;
            width: 80%;
            background-color: #eee;
            margin-bottom: 10px;
        }
        
        .skeleton-text-short {
            width: 40%;
        }
        
        .skeleton-text-medium {
            width: 60%;
        }
        
        .skeleton-text-long {
            width: 90%;
        }
        
        .body-no-scroll {
            overflow: hidden;
        }

        .menu-item {
            padding: 1.125rem 0 !important;
            font-size: 1.5rem !important;
            color: #734432 !important;
            font-family: 'inter-bold', sans-serif !important;
            text-transform: uppercase !important;
            text-decoration: none !important;
            display: block !important;
            transition: color 0.3s ease !important;
        }
        
        .menu-item:active {
            opacity: 0.7;
        }

        .menu-divider {
            width: 100%;
            height: 1px;
            background-color: #734432;
            margin: 5px 0;
        }

        /* Contenu principal */
        .main-content {
            margin-top: 4.375rem;
            height: calc(100vh - 4.375rem);
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .hero-image {
            width: 100%;
            height: fit-content;
          
            object-fit: cover;
            display: block;
            background-color: #ffffff;
        }
        
     
        

        .action-button-image {
            display: block;
            width: 13.25rem;
            height: auto;
            margin: 0.5rem auto 0;
            cursor: pointer;
            transition: transform 0.3s ease;
            z-index: 10;
        }

        .action-button-image:hover {
            transform: translateY(-0.125rem) scale(1.05);
        }
        
        .action-button-image:active {
            transform: translateY(0) scale(0.95);
        }
        
        @media (max-width: 360px) {
            .action-button-image {
                width: 10rem;
            }
        }
        
        @media (min-width: 768px) {
            .action-button-image {
                width: 12.5rem;
            }
        }

        /* Ancien style du bouton - à supprimer */
        .action-button {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Écran de chargement -->
    <div class="loading-screen">
        <div class="logo-container">
            <div class="logo">
                <img src="assets/logo/giante-logo-fdlm.png" alt="Logo">
            </div>
        </div>
    </div>

    <!-- Navbar -->
    <nav class="navbar">
        <a href="index.html"><img src="assets/logo/logo-navbar-fdlm.png" alt="Logo" class="navbar-logo"></a>
        <div class="navbar-right">
            <button class="favorites-btn">Mes favoris</button>
            <div class="menu-icon">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <!-- Menu overlay -->
    <div class="menu-overlay">
        <a href="index.html" class="menu-item" style="margin-bottom: 2vh;">Accueil</a>
        
        <a href="pages/programmation/programmation.html" class="menu-item">Programmation</a>
        <div class="menu-divider"></div>
        
        <a href="pages/proche-de-moi/autour-de-moi.html" class="menu-item">Autour de moi</a>
        <div class="menu-divider"></div>
        <a href="pages/partners/partenaires.html" class="menu-item">Nos partenaires</a>
        <div class="menu-divider"></div>
        <a href="pages/apropos/apropos.html" class="menu-item">Qui sommes-nous ?</a>
        <div class="menu-divider"></div>
        <a href="pages/summer/summer.html" class="menu-item">Pour l'été</a>
    </div>

    <!-- Favoris overlay -->
    <div class="favorites-overlay">
        <div class="favorites-empty">
            <img src="assets/headline/programmation-outline.png" alt="Icône favoris" id="favorites-icon">
            <h3>Vous n'avez pas encore sélectionné de programme favoris</h3>
            <img src="assets/pictos/material-symbols_stars-outline.png" alt="Icône programme" id="program-icon">
            <h3>Rendez-vous sur la programmation pour faire votre choix</h3>
            <img src="assets/buttons/programmation-button.png" alt="Aller à la programmation" class="action-img" id="go-to-program">
        </div>
    </div>

    <!-- Contenu principal -->
    <main class="main-content">
        <img src="assets/images/affiche-mobile@2x.png"  alt="Image principale" class="hero-image">
        <img src="assets/buttons/programmation-button.png" alt="Découvrir la programmation" class="action-button-image" onclick="window.location.href='pages/programmation/programmation.html'">
    </main>

    <!-- Script Firebase -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-app.js";
        import { getFirestore, collection, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCwtimDB_Mai-QPyB6d0yqjJX_d5mQjGY8",
            authDomain: "fete-de-la-musique-64a6b.firebaseapp.com",
            projectId: "fete-de-la-musique-64a6b",
            storageBucket: "fete-de-la-musique-64a6b.firebasestorage.app",
            messagingSenderId: "1087878331068",
            appId: "1:1087878331068:web:28719d3278a619cb816eb9",
            measurementId: "G-MW9YYKP1J8"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Rendre les variables accessibles globalement
        window.db = db;
        window.getDoc = getDoc;
        window.collection = collection;
        window.getDocs = getDocs;
        window.doc = doc;
    </script>

    <script>
        // Variables globales
        let favoritesManager;
        let allEvents = [];
        let soundPoints = [];

        // Gestion de l'écran de chargement
        window.addEventListener('load', function() {
            setTimeout(function() {
                document.querySelector('.loading-screen').classList.add('hide');
            }, 1500);
            
            // Charger les données Firebase après l'écran de chargement
            setTimeout(loadFirebaseData, 2000);
        });

        // Fonction pour charger les données Firebase
        async function loadFirebaseData() {
            try {
                if (!window.db || !window.collection || !window.getDocs) {
                    console.error("Firebase n'est pas initialisé correctement");
                    return;
                }

                // Charger tous les événements
                const eventsCollection = window.collection(window.db, "events");
                const eventsSnapshot = await window.getDocs(eventsCollection);
                
                eventsSnapshot.forEach(eventDoc => {
                    allEvents.push({
                        id: eventDoc.id,
                        ...eventDoc.data()
                    });
                });

                // Charger tous les points sonores
                const soundPointsCollection = window.collection(window.db, "sound_points");
                const soundPointsSnapshot = await window.getDocs(soundPointsCollection);
                
                soundPointsSnapshot.forEach(doc => {
                    const data = doc.data();
                    const pointEvents = allEvents.filter(event => event.location === data.name);
                    
                    soundPoints.push({
                        id: doc.id,
                        ...data,
                        events: pointEvents
                    });
                });

                console.log(`Chargé ${allEvents.length} événements et ${soundPoints.length} points sonores`);

                // Mettre à jour les données du gestionnaire de favoris
                if (favoritesManager) {
                    favoritesManager.setEventsData(allEvents, soundPoints);
                }

            } catch (error) {
                console.error("Erreur lors du chargement des données Firebase:", error);
            }
        }

        // Fonction pour formater l'heure à partir d'un timestamp
        function formatTime(timestamp) {
            try {
                let date;
                
                if (typeof timestamp === 'object') {
                    if (timestamp instanceof Date) {
                        date = timestamp;
                    } else if (timestamp.seconds !== undefined) {
                        date = new Date(timestamp.seconds * 1000 + (timestamp.nanoseconds || 0) / 1000000);
                    } else if (typeof timestamp.toDate === 'function') {
                        date = timestamp.toDate();
                    } else {
                        date = new Date(timestamp);
                    }
                } else if (typeof timestamp === 'number') {
                    date = new Date(timestamp * 1000);
                } else if (typeof timestamp === 'string') {
                    date = new Date(timestamp);
                }
                
                if (!date || isNaN(date.getTime())) {
                    return '00h00';
                }
                
                const hours = date.getHours().toString().padStart(2, '0');
                const minutes = date.getMinutes().toString().padStart(2, '0');
                return `${hours}h${minutes}`;
            } catch (error) {
                console.error("Erreur lors du formatage de l'heure:", error);
                return '00h00';
            }
        }

        // Fonction pour récupérer les coordonnées GPS d'un lieu
        async function fetchGpsCoordinatesForLocation(locationName) {
            try {
                console.log('Recherche des coordonnées GPS pour:', locationName);
                
                const soundPointsCol = collection(db, "sound_points");
                const soundPointsSnapshot = await getDocs(soundPointsCol);
                
                let gpsCoordinates = null;
                
                soundPointsSnapshot.forEach((doc) => {
                    const soundPointData = doc.data();
                    // Check if name matches the event location
                    if (soundPointData.name && 
                        soundPointData.name.toLowerCase() === locationName.toLowerCase()) {
                        gpsCoordinates = soundPointData.gpsCoordinates;
                        console.log('Coordonnées GPS trouvées:', gpsCoordinates);
                    }
                });
                
                return gpsCoordinates;
            } catch (error) {
                console.error("Erreur lors de la récupération des coordonnées GPS:", error);
                return null;
            }
        }

        // Fonction pour créer une URL Google Maps depuis des coordonnées GPS
        function createGoogleMapsUrl(gpsCoordinates) {
            if (!gpsCoordinates) return null;
            
            // If coordinates are in format "43.111298260217424, 5.939361714369257"
            const cleanCoords = gpsCoordinates.replace(/\s/g, ''); // Remove spaces
            return `https://www.google.com/maps?q=${cleanCoords}`;
        }

        // Fonction pour afficher les détails d'un événement
        async function showEventDetails(event) {
            console.log('Affichage des détails de l\'événement:', event);
            
            const detailsOverlay = document.createElement('div');
            detailsOverlay.className = 'event-details-overlay';
            
            const favoriteIconSrc = favoritesManager && favoritesManager.isEventFavorite(event.id) ?
                'assets/pictos/filled-star.png' :
                'assets/pictos/star-card.png';
                
            const startTime = formatTime(event.startDate);
            const endTime = formatTime(event.endDate);
            const timeTag = `${startTime}-${endTime}`;
            
            // Try to get GPS coordinates for the location
            let mapUrl = event.locationUrl; // Fallback to original locationUrl
            
            // Check if GPS URL is pre-loaded (from favorites)
            if (event._gpsUrl) {
                mapUrl = event._gpsUrl;
                console.log('🚀 Utilisation de l\'URL GPS pré-chargée:', mapUrl);
            } else {
                // Fetch GPS coordinates dynamically
                try {
                    console.log('🔍 Récupération dynamique des coordonnées GPS...');
                    const gpsCoordinates = await fetchGpsCoordinatesForLocation(event.location);
                    if (gpsCoordinates) {
                        mapUrl = createGoogleMapsUrl(gpsCoordinates);
                        console.log('✅ URL Google Maps créée dynamiquement:', mapUrl);
                    }
                } catch (error) {
                    console.error('❌ Erreur lors de la récupération des coordonnées:', error);
                    // Keep the original locationUrl as fallback
                }
            }
            
            detailsOverlay.innerHTML = `
                <div class="event-details-container">
                    <div class="details-header">
                        <div class="details-image-container">
                            <img src="${event.imageUrl || 'assets/images/default-event.jpg'}" alt="${event.title}" class="details-image">
                            <button class="close-details">×</button>
                        </div>
                        
                        <div class="details-title-section">
                            <div class="details-title-left">
                                <h2 class="details-title">${event.title}</h2>
                                <p class="details-subtitle">${event.subtitle || ''}</p>
                            </div>
                            <div class="details-title-right">
                                <img src="${favoriteIconSrc}" alt="Ajouter aux favoris" class="details-favorite-icon" data-id="${event.id}">
                            </div>
                        </div>
                        
                        <div class="details-description">
                            <p>${event.description || 'Aucune description disponible.'}</p>
                        </div>
                        
                        ${event.plusUrl ? `
                        <div class="details-more-button">
                            <a href="${event.plusUrl}" target="_blank">
                                <img src="assets/buttons/savoirplusmarron.png" alt="En savoir plus">
                            </a>
                        </div>` : ''}
                        
                        <div class="details-info-section">
                            <div class="details-info-item">
                                <img src="assets/pictos/Clock.png" alt="Time" class="info-icon">
                                <span>${timeTag}</span>
                                <span class="details-separator">/</span>
                                <img src="assets/pictos/PinMapmarron.png" alt="Location" class="info-icon">
                                <span>${event.location || ''}</span>
                            </div>
                            
                            ${mapUrl ? `
                            <div class="details-map-button">
                                <a href="${mapUrl}" target="_blank">
                                    <img src="assets/buttons/syrendre.png" alt="Comment s'y rendre">
                                    ${event._gpsUrl ? '<span style="font-size: 10px; color: #734432; margin-left: 5px;">📍 GPS</span>' : ''}
                                </a>
                            </div>` : ''}
                        </div>
                        
                        <div class="details-partners">
                            <h3>PARTENAIRES</h3>
                            <div class="partners-grid" id="partners-grid">
                                <div class="skeleton skeleton-partner"></div>
                                <div class="skeleton skeleton-partner"></div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(detailsOverlay);
            document.body.classList.add('body-no-scroll');
            
            setTimeout(() => {
                detailsOverlay.classList.add('active');
            }, 10);
            
            // Écouteurs d'événements
            detailsOverlay.querySelector('.close-details').addEventListener('click', () => {
                detailsOverlay.classList.remove('active');
                setTimeout(() => {
                    detailsOverlay.remove();
                    document.body.classList.remove('body-no-scroll');
                }, 300);
            });
            
            const favIcon = detailsOverlay.querySelector('.details-favorite-icon');
            if (favIcon && favoritesManager) {
                favIcon.addEventListener('click', (e) => {
                    e.stopPropagation();
                    favoritesManager.toggleFavorite(event.id, favIcon);
                });
            }
            
            // Charger les partenaires
            fetchPartnersForEvent(event.location, detailsOverlay);
        }

        // Fonction pour récupérer les partenaires d'un événement
        async function fetchPartnersForEvent(location, detailsOverlay) {
            try {
                const soundPoint = soundPoints.find(point => point.name === location);
                
                if (soundPoint && soundPoint.partners && Array.isArray(soundPoint.partners)) {
                    const partnersGrid = detailsOverlay.querySelector('.partners-grid');
                    
                    partnersGrid.innerHTML = '';
                    for (let i = 0; i < 4; i++) {
                        const skeleton = document.createElement('div');
                        skeleton.className = 'skeleton skeleton-partner';
                        partnersGrid.appendChild(skeleton);
                    }
                    
                    const partnerPromises = soundPoint.partners.map(partnerId => 
                        getPartnerDetails(partnerId)
                    );
                    
                    const partners = await Promise.all(partnerPromises);
                    updatePartnersGrid(detailsOverlay, partners);
                    
                } else {
                    const partnersGrid = detailsOverlay.querySelector('.partners-grid');
                    partnersGrid.innerHTML = '<p style="color: white; text-align: center; width: 100%;">Aucun partenaire pour cet événement</p>';
                }
            } catch (error) {
                console.error("Erreur lors de la récupération des partenaires:", error);
                const partnersGrid = detailsOverlay.querySelector('.partners-grid');
                if (partnersGrid) {
                    partnersGrid.innerHTML = '<p style="color: white; text-align: center; width: 100%;">Erreur lors du chargement des partenaires</p>';
                }
            }
        }

        // Fonction pour mettre à jour la grille des partenaires
        function updatePartnersGrid(detailsOverlay, partners) {
            const partnersGrid = detailsOverlay.querySelector('.partners-grid');
            
            partnersGrid.innerHTML = '';
            
            if (!partners || partners.length === 0) {
                partnersGrid.innerHTML = '<p style="color: white; text-align: center; width: 100%;">Aucun partenaire pour cet événement</p>';
                return;
            }
            
            partners.forEach(partner => {
                if (partner) {
                    const partnerDiv = document.createElement('div');
                    partnerDiv.className = 'details-partner';
                    partnerDiv.setAttribute('data-partner-id', partner.id);
                    
                    const img = document.createElement('img');
                    img.className = 'partner-logo';
                    img.alt = partner.name || 'Partenaire';
                    img.loading = 'lazy';
                    
                    img.onerror = function() {
                        this.src = 'assets/images/default-partner.jpg';
                    };
                    
                    img.src = partner.logoUrl || 'assets/images/default-partner.jpg';
                    
                    partnerDiv.appendChild(img);
                    partnerDiv.addEventListener('click', () => showPartnerDetails(partner.id, detailsOverlay));
                    
                    partnersGrid.appendChild(partnerDiv);
                }
            });
        }

        // Fonction pour afficher les détails d'un partenaire
        async function showPartnerDetails(partnerId, detailsOverlay) {
            try {
                const currentContent = detailsOverlay.querySelector('.event-details-container').innerHTML;
                const container = detailsOverlay.querySelector('.event-details-container');
                
                container.style.opacity = '0';
                
                setTimeout(() => {
                    container.innerHTML = `
                        <div class="details-header">
                            <div class="details-image-container">
                                <div class="skeleton-image" style="height: 200px; background-color: #eee;"></div>
                                <button class="close-details">×</button>
                            </div>
                            
                            <div class="details-title-section">
                                <div class="details-title-left">
                                    <div class="skeleton-title" style="height: 28px; width: 70%; background-color: #eee; margin-bottom: 10px;"></div>
                                    <div class="skeleton-subtitle" style="height: 20px; width: 50%; background-color: #eee;"></div>
                                </div>
                            </div>
                            
                            <div class="details-description">
                                <div class="skeleton-description" style="height: 100px; background-color: #eee;"></div>
                            </div>
                        </div>
                    `;
                    
                    container.style.opacity = '1';
                    
                    container.querySelector('.close-details').addEventListener('click', (e) => {
                        e.stopPropagation();
                        container.style.opacity = '0';
                        
                        setTimeout(() => {
                            container.innerHTML = currentContent;
                            container.style.opacity = '1';
                            addEventListenersToRestoredContent(detailsOverlay);
                        }, 300);
                    });
                }, 300);
                
                const partner = await getPartnerDetails(partnerId);
                
                if (!partner) {
                    throw new Error("Partenaire non trouvé");
                }
                
                setTimeout(() => {
                    container.innerHTML = `
                        <div class="details-header">
                            <div class="details-image-container">
                                <img src="${partner.logoUrl || 'assets/images/default-partner.jpg'}" 
                                     alt="${partner.name || 'Partenaire'}" 
                                     class="details-image" 
                                     onerror="this.onerror=null; this.src='assets/images/default-partner.jpg';">
                                <button class="close-details">×</button>
                            </div>
                            
                            <div class="details-title-section">
                                <div class="details-title-left">
                                    <h2 class="details-title">${partner.name || 'Partenaire'}</h2>
                                    <p class="details-subtitle" style="text-transform: uppercase;">${partner.type || ''}</p>
                                </div>
                            </div>
                            
                            <div class="details-description">
                                <p>${partner.description || 'Aucune information disponible sur ce partenaire.'}</p>
                            </div>
                            
                            ${partner.address || partner.phone ? `
                            <div class="details-contact-info" style="margin: 20px 0;">
                                ${partner.address ? `
                                <div class="contact-item">
                                    <img src="assets/pictos/PinMapmarron.png" alt="Adresse" class="info-icon">
                                    <span>${partner.address}</span>
                                </div>` : ''}
                                
                                ${partner.phone ? `
                                <div class="contact-item">
                                    <img src="assets/pictos/Telephone.png" alt="Téléphone" class="info-icon">
                                    <span>${partner.phone}</span>
                                </div>` : ''}
                            </div>` : ''}
                            
                            ${partner.website ? `
                            <div class="details-more-button" style="text-align: center; margin-top: 20px;">
                                <a href="${partner.website.startsWith('http') ? partner.website : 'https://' + partner.website}" 
                                   target="_blank">
                                    <img src="assets/buttons/savoirplusmarron.png" alt="Voir le site web" style="height: 40px;">
                                </a>
                            </div>` : ''}
                        </div>
                    `;
                    
                    container.querySelector('.close-details').addEventListener('click', (e) => {
                        e.stopPropagation();
                        container.style.opacity = '0';
                        
                        setTimeout(() => {
                            container.innerHTML = currentContent;
                            container.style.opacity = '1';
                            addEventListenersToRestoredContent(detailsOverlay);
                        }, 300);
                    });
                    
                    container.style.opacity = '1';
                    
                }, 800);
                
            } catch (error) {
                console.error("Erreur lors du chargement des détails du partenaire:", error);
                alert("Une erreur est survenue lors du chargement des détails du partenaire");
            }
        }

        // Fonction pour réinitialiser les écouteurs d'événements
        function addEventListenersToRestoredContent(detailsOverlay) {
            const partnersGrid = detailsOverlay.querySelector('.partners-grid');
            if (partnersGrid) {
                const partners = partnersGrid.querySelectorAll('.details-partner');
                partners.forEach(partnerDiv => {
                    const partnerId = partnerDiv.getAttribute('data-partner-id');
                    if (partnerId) {
                        partnerDiv.addEventListener('click', () => showPartnerDetails(partnerId, detailsOverlay));
                    }
                });
            }
            
            const closeButton = detailsOverlay.querySelector('.close-details');
            if (closeButton) {
                closeButton.addEventListener('click', () => {
                    const overlay = document.querySelector('.event-details-overlay.active');
                    if (overlay) {
                        overlay.classList.remove('active');
                        setTimeout(() => {
                            overlay.remove();
                            document.body.classList.remove('body-no-scroll');
                        }, 300);
                    }
                });
            }
        }

        // Fonction pour récupérer les détails d'un partenaire
        async function getPartnerDetails(partnerId) {
            try {
                const partnerDoc = await window.getDoc(window.doc(window.db, "partners", partnerId));
                
                if (partnerDoc.exists()) {
                    const partnerData = partnerDoc.data();
                    return {
                        id: partnerId,
                        name: partnerData.name || 'Partenaire',
                        logoUrl: partnerData.logoUrl || partnerData.imageUrl || 'assets/images/default-partner.jpg',
                        description: partnerData.description || partnerData.info || 'Aucune description disponible pour ce partenaire.',
                        type: partnerData.type || '',
                        address: partnerData.address || '',
                        phone: partnerData.phone || '',
                        website: partnerData.website || ''
                    };
                } else {
                    console.warn("Partenaire non trouvé:", partnerId);
                    return null;
                }
            } catch (error) {
                console.error("Erreur lors de la récupération des détails du partenaire:", error);
                return null;
            }
        }

        // Rendre la fonction showEventDetails accessible globalement
        window.showEventDetails = showEventDetails;

        // Gestion du menu hamburger et des favoris
        document.addEventListener('DOMContentLoaded', function() {
            const menuIcon = document.querySelector('.menu-icon');
            const menuOverlay = document.querySelector('.menu-overlay');

            // Initialiser le gestionnaire de favoris
            if (typeof FavoritesManager !== 'undefined') {
                favoritesManager = new FavoritesManager({
                    assetsPath: 'assets/'
                });
                console.log('Gestionnaire de favoris initialisé');
            } else {
                console.error('FavoritesManager non disponible');
            }

            // Gestion du menu hamburger
            menuIcon.addEventListener('click', function() {
                // Fermer l'overlay des favoris s'il est ouvert
                const favoritesOverlay = document.querySelector('.favorites-overlay.active');
                if (favoritesOverlay) {
                    favoritesOverlay.classList.remove('active');
                }
                
                // Fermer les détails d'événement s'ils sont ouverts
                const eventDetailsOverlay = document.querySelector('.event-details-overlay.active');
                if (eventDetailsOverlay) {
                    eventDetailsOverlay.classList.remove('active');
                    setTimeout(() => {
                        eventDetailsOverlay.remove();
                    }, 300);
                }
                
                menuIcon.classList.toggle('active');
                menuOverlay.classList.toggle('active');
                document.body.classList.toggle('body-no-scroll');
            });

            // Gestion spéciale du lien "Mes favoris" dans le menu
            const menuFavorites = document.querySelector('.menu-item[href="#"]');
            if (menuFavorites && favoritesManager) {
                menuFavorites.addEventListener('click', function(e) {
                    e.preventDefault();
                    // Fermer le menu d'abord
                    menuIcon.classList.remove('active');
                    menuOverlay.classList.remove('active');
                    // Puis ouvrir les favoris
                    setTimeout(() => {
                        favoritesManager.loadAndShowFavorites();
                    }, 300);
                });
            }

            // Fermer les overlays en cliquant sur les liens
            const menuItems = document.querySelectorAll('.menu-item');
            menuItems.forEach(item => {
                // Ne pas ajouter l'événement pour le lien favoris car il est géré spécialement
                if (item !== menuFavorites) {
                    item.addEventListener('click', function() {
                        menuIcon.classList.remove('active');
                        menuOverlay.classList.remove('active');
                        document.body.classList.remove('body-no-scroll');
                    });
                }
            });

            // Fermer les overlays en cliquant en dehors
            document.addEventListener('click', function(event) {
                if (!event.target.closest('.menu-icon') && !event.target.closest('.menu-overlay')) {
                    menuIcon.classList.remove('active');
                    menuOverlay.classList.remove('active');
                }
                
                if (!menuOverlay.classList.contains('active')) {
                    document.body.classList.remove('body-no-scroll');
                }
            });
        });
    </script>
</body>
</html>